#include "simpletools.h"                      // Include simple tools
#include "adcDCpropab.h"
#include "servo.h"

int main()
{
  pause(1000); 
  while(1)
  { 
    ///////SWITCH////////
    int button = input(11);
    if (button == 1)
    {
      defaultHappy();
    }   
    pause(100);     
    ///////SWITCH////////
  }  
}

int defaultHappy()
{
  pause(1000);
  while(1)
  {
    ///////SWITCH////////
    int button = input(11);
    if (button == 1)
    {
      defaultSad();
    }
    ///////SWITCH////////  
    
    servo_speed(14,0);
    servo_speed(15,0);
    
    adc_init(21, 20, 19, 18);
    float v1;
  
    v1 = adc_volts(2);                  // Check A/D 1
    print("%f V\n", v1);                // Display volts
  
    if(v1 > 0.5)
    {
      interactiveHappy();
    }      
    pause(100);                        // Wait 1/10 s
  }     
}  

int interactiveHappy()
{
  servo_speed(14,200);
  servo_speed(15,200);
  high(26);
  high(27);
  pause(2000);
  low(26);
  low(27);
  return;
}

int defaultSad()
{
  pause(1000);
  while(1)
  {
    ///////SWITCH////////
    int button = input(11);
    if (button == 1)
    {
      defaultFear();
    }
    ///////SWITCH////////  
    
    
    ////////PING/////////
    float i = -1;
    i = ping(12,13);           
    i = i / 148; //divide the ping by 148 to get inches, or by 54 to get centimeters
    if(i < 10)
    {
      interactiveSad();
    }  
    else
    {
      servo_speed(14,200);
      servo_speed(15,-200);
      pause(100);
    }  
    ////////PING/////////
  }    
}  

int interactiveSad()
{
   servo_speed(14, -200);
   servo_speed(15, 200);
   pause(100);
   return;
}  

int ping(int trig, int echo)//trig is trigger pin, echo is echo pin
{
  low(trig);//set trig low for start pulse
  low(echo);//set echo low to be safe
  pulse_out(trig, 10);//send the minimum 10 ms pulse on trig to start a ping
  return pulse_in(echo, 1);//get the pulse duration back on echo pin
}
